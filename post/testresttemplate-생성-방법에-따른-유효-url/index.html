<!doctype html><html lang=ko-kr dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="TL;DR  new TestRestTemplate  rest.getForEntity(&amp;quot;/hello&amp;quot;, String.class); -&amp;gt; IllegalArgumentException 발생!   @Autowired TestRestTemplate  rest.getForEntity(&amp;quot;/hello&amp;quot;, String.class); -&amp;gt; OK    서론 아래와 같은 흐름에 따라 본 포스트가 작성되었다.
 토비의 스프링 부트 - 이해와 원리 실습 중 TestRestTemplate를 사용하였다. 생성자로 객체를 생성하여 사용하였고, URL은 절대경로를 입력하였다. 강의를 모두 수강한 후, Spring Boot에 대한 이해를 높이기 위해 공식 Reference를 살펴보다가 TestRestTemplate를 사용하는 부분을 확인하였다. @Autowired로 주입받아 사용하였고, URL은 path만 입력하도록 되어 있었다."><title>TestRestTemplate 생성 방법에 따른 유효 URL</title><link rel=canonical href=https://blog.seungyeop-lee.com/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/><link rel=stylesheet href=/scss/style.min.18caff73128ec93cedb60c0bb6c2ab29d426e6bf0fd63f18fdf030a144a3235b.css><meta property="og:title" content="TestRestTemplate 생성 방법에 따른 유효 URL"><meta property="og:description" content="TL;DR  new TestRestTemplate  rest.getForEntity(&amp;quot;/hello&amp;quot;, String.class); -&amp;gt; IllegalArgumentException 발생!   @Autowired TestRestTemplate  rest.getForEntity(&amp;quot;/hello&amp;quot;, String.class); -&amp;gt; OK    서론 아래와 같은 흐름에 따라 본 포스트가 작성되었다.
 토비의 스프링 부트 - 이해와 원리 실습 중 TestRestTemplate를 사용하였다. 생성자로 객체를 생성하여 사용하였고, URL은 절대경로를 입력하였다. 강의를 모두 수강한 후, Spring Boot에 대한 이해를 높이기 위해 공식 Reference를 살펴보다가 TestRestTemplate를 사용하는 부분을 확인하였다. @Autowired로 주입받아 사용하였고, URL은 path만 입력하도록 되어 있었다."><meta property="og:url" content="https://blog.seungyeop-lee.com/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/"><meta property="og:site_name" content="펭귄의 외부 저장소"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="학습 테스트"><meta property="article:tag" content="Spring Boot 3 Test"><meta property="article:tag" content="TestRestTemplate"><meta property="article:published_time" content="2023-01-29T00:00:00+00:00"><meta property="article:modified_time" content="2023-01-30T00:00:00+00:00"><meta property="og:image" content="https://blog.seungyeop-lee.com/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/cover.png"><meta name=twitter:site content="@@xbeast7"><meta name=twitter:creator content="@@xbeast7"><meta name=twitter:title content="TestRestTemplate 생성 방법에 따른 유효 URL"><meta name=twitter:description content="TL;DR  new TestRestTemplate  rest.getForEntity(&amp;quot;/hello&amp;quot;, String.class); -&amp;gt; IllegalArgumentException 발생!   @Autowired TestRestTemplate  rest.getForEntity(&amp;quot;/hello&amp;quot;, String.class); -&amp;gt; OK    서론 아래와 같은 흐름에 따라 본 포스트가 작성되었다.
 토비의 스프링 부트 - 이해와 원리 실습 중 TestRestTemplate를 사용하였다. 생성자로 객체를 생성하여 사용하였고, URL은 절대경로를 입력하였다. 강의를 모두 수강한 후, Spring Boot에 대한 이해를 높이기 위해 공식 Reference를 살펴보다가 TestRestTemplate를 사용하는 부분을 확인하였다. @Autowired로 주입받아 사용하였고, URL은 path만 입력하도록 되어 있었다."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.seungyeop-lee.com/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/cover.png"><link rel="shortcut icon" href=/icon/favicon.ico><script type=application/javascript>var doNotTrack=!1;doNotTrack||(function(e,o,i,a,t,n,s){e.GoogleAnalyticsObject=t,e[t]=e[t]||function(){(e[t].q=e[t].q||[]).push(arguments)},e[t].l=1*new Date,n=o.createElement(i),s=o.getElementsByTagName(i)[0],n.async=1,n.src=a,s.parentNode.insertBefore(n,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-189675722-1","auto"),ga("send","pageview"))</script></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"light")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="메뉴 여닫기">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu9777283d0b785254b12ffb8c3f9befa6_920044_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>펭귄의 외부 저장소</a></h1><h2 class=site-description>읽은 것, 본 것, 배운 것, 삽질, etc</h2></div></header><ol class=social-menu><li><a href=https://github.com/seungyeop-lee target=_blank title=GitHub><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg><span>Home</span></a></li><li><a href=/archives><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg><span>Archives</span></a></li><li><a href=/search><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg><span>Search</span></a></li><li><a href=/links><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg><span>Links</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg><span>다크 모드</span></li></div></ol></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/><img src=/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/cover_hu8b1a59c6fefc852fae101fe9aa81f62c_34853_800x0_resize_box_3.png srcset="/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/cover_hu8b1a59c6fefc852fae101fe9aa81f62c_34853_800x0_resize_box_3.png 800w, /post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/cover_hu8b1a59c6fefc852fae101fe9aa81f62c_34853_1600x0_resize_box_3.png 1600w" width=800 height=258 loading=lazy alt="Featured image of post TestRestTemplate 생성 방법에 따른 유효 URL"></a></div><div class=article-details><header class=article-category><a href=/categories/backend/>Backend</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/>TestRestTemplate 생성 방법에 따른 유효 URL</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>Jan 29, 2023</time></div></footer></div></header><section class=article-content><h2 id=tldr>TL;DR</h2><ul><li><code>new TestRestTemplate</code><ul><li><code>rest.getForEntity("/hello", String.class);</code> -> IllegalArgumentException 발생!</li></ul></li><li><code>@Autowired TestRestTemplate</code><ul><li><code>rest.getForEntity("/hello", String.class);</code> -> OK</li></ul></li></ul><h2 id=서론>서론</h2><p>아래와 같은 흐름에 따라 본 포스트가 작성되었다.</p><ol><li><a class=link href=https://www.inflearn.com/course/%ed%86%a0%eb%b9%84-%ec%8a%a4%ed%94%84%eb%a7%81%eb%b6%80%ed%8a%b8-%ec%9d%b4%ed%95%b4%ec%99%80%ec%9b%90%eb%a6%ac title="토비의 스프링 부트 - 이해와 원리" target=_blank rel=noopener>토비의 스프링 부트 - 이해와 원리</a> 실습 중 <code>TestRestTemplate</code>를 사용하였다. 생성자로 객체를 생성하여 사용하였고, URL은 절대경로를 입력하였다.</li><li>강의를 모두 수강한 후, Spring Boot에 대한 이해를 높이기 위해 <a class=link href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.spring-boot-applications.with-running-server title="Spring Boot Reference Documentation - Testing With a Running Server" target=_blank rel=noopener>공식 Reference</a>를 살펴보다가 <code>TestRestTemplate</code>를 사용하는 부분을 확인하였다. <code>@Autowired</code>로
주입받아 사용하였고, URL은 path만 입력하도록 되어 있었다.</li><li>강의 실습코드에 <code>TestRestTemplate</code>를 사용한 부분으로 실험을 하여 아래의 결과를 얻었다.<ul><li>URL을 path만 입력하도록 변경하였더니 예외가 발생하였다.</li><li><code>TestRestTemplate</code>를 <code>@Autowired</code>로 주입받는 방식으로 변경하였더니 예외가 발생하지 않았다.</li></ul></li><li>직접 생성한 객체와 Spring Boot가 생성하여 주입해주는 객체의 움직임 차이를 명확히 확인하기 위해 <a class=link href=#%ed%95%99%ec%8a%b5-%ed%85%8c%ec%8a%a4%ed%8a%b8---%ec%83%9d%ec%84%b1-%eb%b0%a9%eb%b2%95%ec%97%90-%eb%94%b0%eb%a5%b8-url-%ec%82%ac%ec%9a%a9-%ea%b0%80%eb%8a%a5-%ec%97%ac%eb%b6%80-%ed%99%95%ec%9d%b8>학습 테스트</a>를 작성하였다.</li><li>원인 파악을 위해 <a class=link href=#testresttemplate-%ec%bd%94%eb%93%9c-%eb%b6%84%ec%84%9d>소스 코드를 분석</a>하였고, 차이점을 확인하여 내부구현을 확인하는 <a class=link href=#%ed%95%99%ec%8a%b5-%ed%85%8c%ec%8a%a4%ed%8a%b8---%eb%82%b4%eb%b6%80-%ea%b5%ac%ed%98%84-%ed%99%95%ec%9d%b8>학습 테스트</a>를 작성하였다.</li><li>생성 방식에 따른 구현 차이에 대한 이해를 돕기위해 <a class=link href=#testresttemplate-%ec%9d%98%ec%a1%b4%ec%84%b1-%eb%8b%a4%ec%9d%b4%ec%96%b4%ea%b7%b8%eb%9e%a8>다이어그램</a>을 작성하였다.</li></ol><p>학습 테스트는 <a class=link href=https://github.com/seungyeop-lee/study-test/tree/main/framework/spring/test/testRestTemplate title="study-test TestRestTemplate" target=_blank rel=noopener>Github Repository</a>에 공개되어 있으며, Spring Boot 3.0.2 버전 기준으로 작성되었다.</p><h2 id=학습-테스트---생성-방법에-따른-url-사용-가능-여부-확인>학습 테스트 - 생성 방법에 따른 URL 사용 가능 여부 확인</h2><h3 id=new-testresttemplate><code>new TestRestTemplate</code></h3><p>Path 경로 만을 사용 할 경우, <strong>IllegalArgumentException 예외</strong>가 발생하였고, <strong>URI is not absolute</strong> 라는 메세지가 출력된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=o>(</span><span class=n>webEnvironment</span> <span class=o>=</span> <span class=n>SpringBootTest</span><span class=o>.</span><span class=na>WebEnvironment</span><span class=o>.</span><span class=na>DEFINED_PORT</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>NewTestRestTemplateTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>TestRestTemplate</span> <span class=n>rest</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@BeforeEach</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>init</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>rest</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TestRestTemplate</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=nd>@DisplayName</span><span class=o>(</span><span class=s>&#34;절대 경로 사용&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>absoluteURLTest</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>res</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span><span class=s>&#34;http://localhost:8080/hello?name={name}&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=s>&#34;Spring&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getStatusCode</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getHeaders</span><span class=o>().</span><span class=na>getFirst</span><span class=o>(</span><span class=n>HttpHeaders</span><span class=o>.</span><span class=na>CONTENT_TYPE</span><span class=o>)).</span><span class=na>startsWith</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>TEXT_PLAIN_VALUE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getBody</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=s>&#34;Spring&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=nd>@DisplayName</span><span class=o>(</span><span class=s>&#34;Path 경로 만으로는 사용 불가능&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>pathURLTest</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThatThrownBy</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                <span class=o>()</span> <span class=o>-&gt;</span> <span class=n>rest</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span><span class=s>&#34;/hello?name={name}&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=s>&#34;Spring&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>).</span><span class=na>isInstanceOf</span><span class=o>(</span><span class=n>IllegalArgumentException</span><span class=o>.</span><span class=na>class</span><span class=o>).</span><span class=na>hasMessage</span><span class=o>(</span><span class=s>&#34;URI is not absolute&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=autowired-testresttemplate><code>@Autowired TestRestTemplate</code></h3><p>하지만 <code>@Autowired</code>로 주입받을 경우, Path 경로 만 사용하여도 문제가 없다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=o>(</span><span class=n>webEnvironment</span> <span class=o>=</span> <span class=n>SpringBootTest</span><span class=o>.</span><span class=na>WebEnvironment</span><span class=o>.</span><span class=na>DEFINED_PORT</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>AutowiredTestRestTemplateTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Autowired</span>
</span></span><span class=line><span class=cl>    <span class=n>TestRestTemplate</span> <span class=n>rest</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=nd>@DisplayName</span><span class=o>(</span><span class=s>&#34;절대 경로 사용&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>absoluteURLTest</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>res</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span><span class=s>&#34;http://localhost:8080/hello?name={name}&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=s>&#34;Spring&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getStatusCode</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getHeaders</span><span class=o>().</span><span class=na>getFirst</span><span class=o>(</span><span class=n>HttpHeaders</span><span class=o>.</span><span class=na>CONTENT_TYPE</span><span class=o>)).</span><span class=na>startsWith</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>TEXT_PLAIN_VALUE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getBody</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=s>&#34;Spring&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=nd>@DisplayName</span><span class=o>(</span><span class=s>&#34;Path 경로 만으로도 사용 가능&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>pathURLTest</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>ResponseEntity</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>res</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getForEntity</span><span class=o>(</span><span class=s>&#34;/hello?name={name}&#34;</span><span class=o>,</span> <span class=n>String</span><span class=o>.</span><span class=na>class</span><span class=o>,</span> <span class=s>&#34;Spring&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getStatusCode</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=n>HttpStatus</span><span class=o>.</span><span class=na>OK</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getHeaders</span><span class=o>().</span><span class=na>getFirst</span><span class=o>(</span><span class=n>HttpHeaders</span><span class=o>.</span><span class=na>CONTENT_TYPE</span><span class=o>)).</span><span class=na>startsWith</span><span class=o>(</span><span class=n>MediaType</span><span class=o>.</span><span class=na>TEXT_PLAIN_VALUE</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>res</span><span class=o>.</span><span class=na>getBody</span><span class=o>()).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=s>&#34;Spring&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=testresttemplate-코드-분석>TestRestTemplate 코드 분석</h2><h3 id=기본-흐름>기본 흐름</h3><p><code>TestRestTemplate</code>는 내부적으로 <code>RestTemplate</code>를 가지고 있어, 실제 행위는 <code>RestTemplate</code>에게 위임하는 방식으로 동작한다.
<code>RestTemplate</code>는 <code>UriTemplateHandler</code>를 통해 URI를 확정한다.</p><h3 id=new-testresttemplate-1><code>new TestRestTemplate</code></h3><p>객체를 직접 생성하는 경우, <code>UriTemplateHandler</code>의 구현체로 <code>DefaultUriBuilderFactory</code>가 사용된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span><span class=lnt>9
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// spring-web-6.0.4-sources.jar!/org/springframework/web/client/RestTemplate.java:218#RestTemplate()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=k>this</span><span class=o>.</span><span class=na>uriTemplateHandler</span> <span class=o>=</span> <span class=n>initUriTemplateHandler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// spring-web-6.0.4-sources.jar!/org/springframework/web/client/RestTemplate.java:252#initUriTemplateHandler()
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>private</span> <span class=kd>static</span> <span class=n>DefaultUriBuilderFactory</span> <span class=nf>initUriTemplateHandler</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>DefaultUriBuilderFactory</span> <span class=n>uriFactory</span> <span class=o>=</span> <span class=k>new</span> <span class=n>DefaultUriBuilderFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>uriFactory</span><span class=o>.</span><span class=na>setEncodingMode</span><span class=o>(</span><span class=n>EncodingMode</span><span class=o>.</span><span class=na>URI_COMPONENT</span><span class=o>);</span>  <span class=c1>// for backwards compatibility..
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>return</span> <span class=n>uriFactory</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>new DefaultUriBuilderFactory()</code>로 생성될 경우, <code>expand</code>메서드를 통해 URI 확정 시, 클라이언트에서 입력한 URL그대로를 사용한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// spring-web-6.0.4-sources.jar!/org/springframework/web/util/DefaultUriBuilderFactory.java:42
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>DefaultUriBuilderFactory</span> <span class=kd>implements</span> <span class=n>UriBuilderFactory</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Nullable</span>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>final</span> <span class=n>UriComponentsBuilder</span> <span class=n>baseUri</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=nf>DefaultUriBuilderFactory</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>baseUri</span> <span class=o>=</span> <span class=kc>null</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>URI</span> <span class=nf>expand</span><span class=o>(</span><span class=n>String</span> <span class=n>uriTemplate</span><span class=o>,</span> <span class=n>Object</span><span class=o>...</span> <span class=n>uriVars</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>uriString</span><span class=o>(</span><span class=n>uriTemplate</span><span class=o>).</span><span class=na>build</span><span class=o>(</span><span class=n>uriVars</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>UriBuilder</span> <span class=nf>uriString</span><span class=o>(</span><span class=n>String</span> <span class=n>uriTemplate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>new</span> <span class=n>DefaultUriBuilder</span><span class=o>(</span><span class=n>uriTemplate</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>class</span> <span class=nc>DefaultUriBuilder</span> <span class=kd>implements</span> <span class=n>UriBuilder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=kd>final</span> <span class=n>UriComponentsBuilder</span> <span class=n>uriComponentsBuilder</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=nf>DefaultUriBuilder</span><span class=o>(</span><span class=n>String</span> <span class=n>uriTemplate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>this</span><span class=o>.</span><span class=na>uriComponentsBuilder</span> <span class=o>=</span> <span class=n>initUriComponentsBuilder</span><span class=o>(</span><span class=n>uriTemplate</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>UriComponentsBuilder</span> <span class=nf>initUriComponentsBuilder</span><span class=o>(</span><span class=n>String</span> <span class=n>uriTemplate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>UriComponentsBuilder</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=o>...</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>result</span> <span class=o>=</span> <span class=n>UriComponentsBuilder</span><span class=o>.</span><span class=na>fromUriString</span><span class=o>(</span><span class=n>uriTemplate</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=o>...</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>result</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=o>...</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>        <span class=kd>public</span> <span class=n>URI</span> <span class=nf>build</span><span class=o>(</span><span class=n>Object</span><span class=o>...</span> <span class=n>uriVars</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=o>...</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>UriComponents</span> <span class=n>uric</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>uriComponentsBuilder</span><span class=o>.</span><span class=na>build</span><span class=o>().</span><span class=na>expand</span><span class=o>(</span><span class=n>uriVars</span><span class=o>);</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>createUri</span><span class=o>(</span><span class=n>uric</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=kd>private</span> <span class=n>URI</span> <span class=nf>createUri</span><span class=o>(</span><span class=n>UriComponents</span> <span class=n>uric</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=o>(</span><span class=n>encodingMode</span><span class=o>.</span><span class=na>equals</span><span class=o>(</span><span class=n>EncodingMode</span><span class=o>.</span><span class=na>URI_COMPONENT</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=n>uric</span> <span class=o>=</span> <span class=n>uric</span><span class=o>.</span><span class=na>encode</span><span class=o>();</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>URI</span><span class=o>.</span><span class=na>create</span><span class=o>(</span><span class=n>uric</span><span class=o>.</span><span class=na>toString</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=autowired-testresttemplate-1><code>@Autowired TestRestTemplate</code></h3><p>Spring Boot가 TestRestTemplate를 빈으로 등록하여 주입하는 경우, <code>UriTemplateHandler</code>의 구현체로 <code>LocalHostUriTemplateHandler</code>가 사용된다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// spring-boot-test-3.0.2-sources.jar!/org/springframework/boot/test/web/client/TestRestTemplateContextCustomizer.java:130
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>TestRestTemplateFactory</span> <span class=kd>implements</span> <span class=n>FactoryBean</span><span class=o>&lt;</span><span class=n>TestRestTemplate</span><span class=o>&gt;,</span> <span class=n>ApplicationContextAware</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>TestRestTemplate</span> <span class=n>template</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setApplicationContext</span><span class=o>(</span><span class=n>ApplicationContext</span> <span class=n>applicationContext</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>BeansException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>RestTemplateBuilder</span> <span class=n>builder</span> <span class=o>=</span> <span class=n>getRestTemplateBuilder</span><span class=o>(</span><span class=n>applicationContext</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=kt>boolean</span> <span class=n>sslEnabled</span> <span class=o>=</span> <span class=n>isSslEnabled</span><span class=o>(</span><span class=n>applicationContext</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>TestRestTemplate</span> <span class=n>template</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TestRestTemplate</span><span class=o>(</span><span class=n>builder</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span> <span class=kc>null</span><span class=o>,</span>
</span></span><span class=line><span class=cl>                <span class=n>sslEnabled</span> <span class=o>?</span> <span class=n>SSL_OPTIONS</span> <span class=o>:</span> <span class=n>DEFAULT_OPTIONS</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>LocalHostUriTemplateHandler</span> <span class=n>handler</span> <span class=o>=</span> <span class=k>new</span> <span class=n>LocalHostUriTemplateHandler</span><span class=o>(</span><span class=n>applicationContext</span><span class=o>.</span><span class=na>getEnvironment</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>                <span class=n>sslEnabled</span> <span class=o>?</span> <span class=s>&#34;https&#34;</span> <span class=o>:</span> <span class=s>&#34;http&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>template</span><span class=o>.</span><span class=na>setUriTemplateHandler</span><span class=o>(</span><span class=n>handler</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>this</span><span class=o>.</span><span class=na>template</span> <span class=o>=</span> <span class=n>template</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><p><code>new LocalHostUriTemplateHandler(applicationContext.getEnvironment())</code>로 생성될 경우,
<code>expand</code>메서드를 통해 URI 확정 시, 클라이언트에서 입력한 URL이 &lsquo;/&lsquo;로 시작 할 경우, rootUri를 추가하여 사용한다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// spring-boot-test-3.0.2-sources.jar!/org/springframework/boot/test/web/client/LocalHostUriTemplateHandler.java:35
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>LocalHostUriTemplateHandler</span> <span class=kd>extends</span> <span class=n>RootUriTemplateHandler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>String</span> <span class=nf>getRootUri</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>port</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>environment</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=s>&#34;local.server.port&#34;</span><span class=o>,</span> <span class=s>&#34;8080&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>contextPath</span> <span class=o>=</span> <span class=k>this</span><span class=o>.</span><span class=na>environment</span><span class=o>.</span><span class=na>getProperty</span><span class=o>(</span><span class=n>PREFIX</span> <span class=o>+</span> <span class=s>&#34;context-path&#34;</span><span class=o>,</span> <span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>scheme</span> <span class=o>+</span> <span class=s>&#34;://localhost:&#34;</span> <span class=o>+</span> <span class=n>port</span> <span class=o>+</span> <span class=n>contextPath</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// spring-boot-3.0.2-sources.jar!/org/springframework/boot/web/client/RootUriTemplateHandler.java:35
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>public</span> <span class=kd>class</span> <span class=nc>RootUriTemplateHandler</span> <span class=kd>implements</span> <span class=n>UriTemplateHandler</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>URI</span> <span class=nf>expand</span><span class=o>(</span><span class=n>String</span> <span class=n>uriTemplate</span><span class=o>,</span> <span class=n>Object</span><span class=o>...</span> <span class=n>uriVariables</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=k>this</span><span class=o>.</span><span class=na>handler</span><span class=o>.</span><span class=na>expand</span><span class=o>(</span><span class=n>apply</span><span class=o>(</span><span class=n>uriTemplate</span><span class=o>),</span> <span class=n>uriVariables</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>	
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=n>String</span> <span class=nf>apply</span><span class=o>(</span><span class=n>String</span> <span class=n>uriTemplate</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=o>(</span><span class=n>StringUtils</span><span class=o>.</span><span class=na>startsWithIgnoreCase</span><span class=o>(</span><span class=n>uriTemplate</span><span class=o>,</span> <span class=s>&#34;/&#34;</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        	<span class=k>return</span> <span class=n>getRootUri</span><span class=o>()</span> <span class=o>+</span> <span class=n>uriTemplate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>uriTemplate</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=testresttemplate-의존성-다이어그램>TestRestTemplate 의존성 다이어그램</h3><p><img src=/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/TestRestTemplate-diagram.png width=2142 height=982 srcset="/post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/TestRestTemplate-diagram_hua9bd88340f5a051643cd2020aee085e6_106161_480x0_resize_box_3.png 480w, /post/testresttemplate-%EC%83%9D%EC%84%B1-%EB%B0%A9%EB%B2%95%EC%97%90-%EB%94%B0%EB%A5%B8-%EC%9C%A0%ED%9A%A8-url/TestRestTemplate-diagram_hua9bd88340f5a051643cd2020aee085e6_106161_1024x0_resize_box_3.png 1024w" loading=lazy alt="TestRestTemplate 의존성 다이어그램" class=gallery-image data-flex-grow=218 data-flex-basis=523px></p><h2 id=학습-테스트---내부-구현-확인>학습 테스트 - 내부 구현 확인</h2><p>TestRestTemplate가 사용하는 rootUri와 uri를 해결하는 Handler의 구현체가 상이함을 테스트로 확인하였다.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@SpringBootTest</span><span class=o>(</span><span class=n>webEnvironment</span> <span class=o>=</span> <span class=n>SpringBootTest</span><span class=o>.</span><span class=na>WebEnvironment</span><span class=o>.</span><span class=na>DEFINED_PORT</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=kd>public</span> <span class=kd>class</span> <span class=nc>TestRestTemplateInitTest</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>checkAutowired</span><span class=o>(</span><span class=nd>@Autowired</span> <span class=n>TestRestTemplate</span> <span class=n>rest</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>rootUri</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getRootUri</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>rootUri</span><span class=o>).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=s>&#34;http://localhost:8080&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>UriTemplateHandler</span> <span class=n>uriTemplateHandler</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getRestTemplate</span><span class=o>().</span><span class=na>getUriTemplateHandler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>uriTemplateHandler</span><span class=o>).</span><span class=na>isInstanceOf</span><span class=o>(</span><span class=n>LocalHostUriTemplateHandler</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Test</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>checkNew</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>TestRestTemplate</span> <span class=n>rest</span> <span class=o>=</span> <span class=k>new</span> <span class=n>TestRestTemplate</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>String</span> <span class=n>rootUri</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getRootUri</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>rootUri</span><span class=o>).</span><span class=na>isEqualTo</span><span class=o>(</span><span class=s>&#34;&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>UriTemplateHandler</span> <span class=n>uriTemplateHandler</span> <span class=o>=</span> <span class=n>rest</span><span class=o>.</span><span class=na>getRestTemplate</span><span class=o>().</span><span class=na>getUriTemplateHandler</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>assertThat</span><span class=o>(</span><span class=n>uriTemplateHandler</span><span class=o>).</span><span class=na>isInstanceOf</span><span class=o>(</span><span class=n>DefaultUriBuilderFactory</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=덧붙이는-말>덧붙이는 말</h2><p><a class=link href=https://www.inflearn.com/course/%ed%86%a0%eb%b9%84-%ec%8a%a4%ed%94%84%eb%a7%81%eb%b6%80%ed%8a%b8-%ec%9d%b4%ed%95%b4%ec%99%80%ec%9b%90%eb%a6%ac title="토비의 스프링 부트 - 이해와 원리" target=_blank rel=noopener>토비의 스프링 부트- 이해와 원리</a>에서 스프링 부트의 자동 구성 흐름을 배움으로서 스프링 내부 코드를 읽는 것이 조금은 수월해 졌음을 느꼈다. 스프링 부트의 자동구성 마법을 쉽고 빠르게 이해하고 싶다면 강추한다.</p><h2 id=ref>ref.</h2><ul><li><a class=link href=https://www.inflearn.com/course/%ed%86%a0%eb%b9%84-%ec%8a%a4%ed%94%84%eb%a7%81%eb%b6%80%ed%8a%b8-%ec%9d%b4%ed%95%b4%ec%99%80%ec%9b%90%eb%a6%ac title="토비의 스프링 부트 - 이해와 원리" target=_blank rel=noopener>토비의 스프링 부트 - 이해와 원리</a></li><li><a class=link href=https://docs.spring.io/spring-boot/docs/current/reference/htmlsingle/#features.testing.spring-boot-applications.with-running-server title="Spring Boot Reference Documentation - Testing With a Running Server" target=_blank rel=noopener>Spring Boot Reference Documentation - Testing With a Running Server</a></li><li><a class=link href=https://github.com/seungyeop-lee/study-test/tree/main/framework/spring/test/testRestTemplate title="study-test TestRestTemplate" target=_blank rel=noopener>학습 테스트 Github Repository</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/%ED%95%99%EC%8A%B5-%ED%85%8C%EC%8A%A4%ED%8A%B8/>학습 테스트</a>
<a href=/tags/spring-boot-3-test/>Spring Boot 3 Test</a>
<a href=/tags/testresttemplate/>TestRestTemplate</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section><section class=article-lastmod><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><span>마지막 수정: Jan 30, 2023 00:00 KST</span></section></footer></article><aside class=related-contents--wrapper><h2 class=section-title>관련 글</h2><div class=related-contents><div class="flex article-list--tile"><article class=has-image><a href=/post/spring-boot-3%EC%97%90%EC%84%9C-querydsl-%EC%82%AC%EC%9A%A9-%EC%8B%9C-build-%EC%8B%A4%ED%8C%A8-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0/><div class=article-image><img src=/post/spring-boot-3%EC%97%90%EC%84%9C-querydsl-%EC%82%AC%EC%9A%A9-%EC%8B%9C-build-%EC%8B%A4%ED%8C%A8-%EB%AC%B8%EC%A0%9C-%ED%95%B4%EA%B2%B0/cover.2d47208b1de5fc94455d100c539270db_hu862c4cd22f7d05d7feb4f86586e6a0e1_20670_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post Spring Boot 3에서 QueryDSL 사용 시 build 실패 문제 해결" data-hash="md5-LUcgix3l/JRFXRAMU5Jw2w=="></div><div class=article-details><h2 class=article-title>Spring Boot 3에서 QueryDSL 사용 시 build 실패 문제 해결</h2></div></a></article></div></div></aside><script src=https://utteranc.es/client.js repo=seungyeop-lee/seungyeop-lee.github.io issue-term=pathname label=comment crossorigin=anonymous async></script><style>.utterances{max-width:unset}</style><script>function setUtterancesTheme(t){let e=document.querySelector(".utterances iframe");e&&e.contentWindow.postMessage({type:"set-theme",theme:`github-${t}`},"https://utteranc.es")}addEventListener("message",e=>{if(e.origin!=="https://utteranc.es")return;setUtterancesTheme(document.documentElement.dataset.scheme)}),window.addEventListener("onColorSchemeChange",e=>{setUtterancesTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2021 -
2023 펭귄의 외부 저장소</section><section class=powerby><a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a>로 만듦<br><a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a>의 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.11.0>Stack</a></b> 테마 사용 중</section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)"></button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css integrity="sha256-c0uckgykQ9v5k+IqViZOZKc47Jn7KQil4/MP3ySA3F8=" crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE=" crossorigin=anonymous></main><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">목차</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#tldr>TL;DR</a></li><li><a href=#서론>서론</a></li><li><a href=#학습-테스트---생성-방법에-따른-url-사용-가능-여부-확인>학습 테스트 - 생성 방법에 따른 URL 사용 가능 여부 확인</a><ol><li><a href=#new-testresttemplate><code>new TestRestTemplate</code></a></li><li><a href=#autowired-testresttemplate><code>@Autowired TestRestTemplate</code></a></li></ol></li><li><a href=#testresttemplate-코드-분석>TestRestTemplate 코드 분석</a><ol><li><a href=#기본-흐름>기본 흐름</a></li><li><a href=#new-testresttemplate-1><code>new TestRestTemplate</code></a></li><li><a href=#autowired-testresttemplate-1><code>@Autowired TestRestTemplate</code></a></li><li><a href=#testresttemplate-의존성-다이어그램>TestRestTemplate 의존성 다이어그램</a></li></ol></li><li><a href=#학습-테스트---내부-구현-확인>학습 테스트 - 내부 구현 확인</a></li><li><a href=#덧붙이는-말>덧붙이는 말</a></li><li><a href=#ref>ref.</a></li></ol></nav></div></section></aside></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script>
<script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>